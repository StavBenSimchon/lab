name: CI-dev

on:
  push:
    branches:
    - develop


  workflow_dispatch:
env:
  MSG: HELLO
jobs:
  ci:
    runs-on: ubuntu-latest
    outputs:
      msg: ${{ steps.test.outputs.msg }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - run: |
          git config --global user.email "github@no-reply.copm"
          git config --global user.name "Github Action"
          echo "test" >> a
          git add -A
          git commit -m 'test'
      - run: |
          git push -f
      - id: test
        run: |
          echo "::set-output name=msg::hello"
      - name: get commit sha
        run: |
          # get the latests commit sha for building images
          echo "GITHUB_SHA_SHORT=$(echo $(git rev-parse HEAD) | cut -c 1-7)" >> $GITHUB_ENV
          echo "GITHUB_SHA_SHORT: ${GITHUB_SHA_SHORT}"
      - run: |
          echo "GITHUB_SHA_SHORT: ${GITHUB_SHA_SHORT}"
      - run: |
          echo "running build"
          echo "GITHUB_SHA_SHORT=AA" >> $GITHUB_ENV
          echo "GITHUB_SHA_SHORT: ${GITHUB_SHA_SHORT}"
          echo "GITHUB_SHA_SHORT2: ${{ env.GITHUB_SHA_SHORT }}"
      - if: env.GITHUB_SHA_SHORT == 'AA'
        run: |
          echo running ${{ env.GITHUB_SHA_SHORT }}
  success:
    needs: ci
    runs-on: ubuntu-latest
    steps:
      - id: slack-passed
        run: |
          echo "succeed"
          echo ">>${{needs.ci.outputs.msg}}"